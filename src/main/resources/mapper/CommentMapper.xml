<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="dao.CommentDao">
    <resultMap id="commentMap" type="pojo.Comments">
        <id property="commentId" column="commentId"></id>
        <result property="commentPostId" column="commentPostId"></result>
        <result property="commentDate" column="commentDate"></result>
        <result property="commentContent" column="commentContent"></result>
        <result property="commentApproved" column="commentApproved"></result>
        <result property="commentParent" column="commentParent"></result>
        <association property="user" column="userId" select="dao.UserDao.getUserByID"></association>
    </resultMap>

    <insert id="saveComments">
        INSERT INTO comments(commentPostId, commentDate, commentContent, commentApproved, commentParent, userId)
        values(#{commentPostId}, #{commentDate}, #{commentContent}, #{commentApproved}, #{commentParent}, #{user.ID})
    </insert>

    <select id="listCommentsByPid" resultMap="commentMap">
        select commentId, commentPostId, commentDate, commentContent, commentApproved, commentParent, userId from comments WHERE commentPostId = #{pid} and commentApproved = true;
    </select>

    <select id="getUserCommentsNum" resultType="long">
        SELECT count(0) FROM comments WHERE userId = #{uid} and commentApproved = true;
    </select>

</mapper>